<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>faces.js editor</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <style>
      .mb-lots {
        margin-bottom: 3rem;
      }

      #face {
        height: 600px;
        width: 400px;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col">
          <h1 class="mb-4 mt-2">
            faces.js editor
            <button
              type="button"
              class="btn btn-primary btn-lg ml-3"
              id="randomize"
            >
              Randomize Checked Items
            </button>
          </h1>
          <form>
            <div class="row">
              <div class="col">
                <div class="p-3 bg-warning bg-gradient">
                  <div class="row">
                    <div class="col-10"><h4>Body</h4></div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-group randomize-body"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-body-group"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-10 form-group">
                      <select class="form-control" id="body-id"> </select>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-body"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-body-id"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-5">
                      <label for="body-color">Skin Color</label>
                    </div>
                    <div class="col-5 form-group">
                      <input
                        type="color"
                        class="form-control"
                        id="body-color"
                      />
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-body"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-body-color"
                      />
                    </div>
                  </div>
                </div>
                <br />
                <div class="p-3 bg-info bg-gradient">
                  <div class="row">
                    <div class="col-10"><h4>Misc Lines</h4></div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-group randomize-misc-lines"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-misc-lines"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-10">
                      <div class="form-group">
                        <select class="form-control" id="miscLine-id"> </select>
                      </div>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-misc-lines"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-miscLine-id"
                      />
                    </div>
                  </div>
                </div>
                <br />
                <div class="p-3 bg-warning bg-gradient">
                  <div class="row">
                    <div class="col-10"><h4>Eye Lines</h4></div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-group randomize-eye-lines"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-eye-lines"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-10">
                      <div class="form-group">
                        <select class="form-control" id="eyeLine-id"> </select>
                      </div>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-eye-lines"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-eyeLine-id"
                      />
                    </div>
                  </div>
                </div>
                <br />
                <div class="p-3 bg-info bg-gradient">
                  <div class="row">
                    <div class="col-10"><h4>Smile Lines</h4></div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-group randomize-smile-lines"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-smile-lines"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-10">
                      <div class="form-group">
                        <select class="form-control" id="smileLine-id">
                        </select>
                      </div>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-smile-lines"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-smileLine-id"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-5">
                      <label for="smileLine-size">Size</label>
                    </div>
                    <div class="col-5 form-group">
                      <input
                        type="number"
                        class="form-control"
                        id="smileLine-size"
                        min=".5"
                        max="1.5"
                        step="0.01"
                      />
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-smile-lines"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-smileLine-size"
                      />
                    </div>
                  </div>
                </div>
                <br />
                <div class="p-3 bg-warning bg-gradient">
                  <div class="row">
                    <div class="col-10"><h4>Aging</h4></div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-group randomize-smile-lines"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-aging"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-10">
                      <div class="form-group">
                        <select class="form-control" id="aging-enabled">
                        </select>
                      </div>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-aging"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-aging-enabled"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-5">
                      <label for="aging-age">Age</label>
                    </div>
                    <div class="col-5 form-group">
                      <input
                        type="number"
                        class="form-control"
                        id="aging-age"
                        min="18"
                        max="40"
                        step="1"
                      />
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-aging"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-aging-age"
                      />
                    </div>
                  </div>
                </div>
              </div>
              <div class="col">
                <div class="p-3 bg-info bg-gradient">
                  <div class="row">
                    <div class="col-10"><h4>Head</h4></div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-group randomize-head"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-head-group"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-10 form-group">
                      <select class="form-control" id="head-id"> </select>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-head"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-head"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-5">
                      <label for="fatness" style="line-height: 2.4em;"
                        >Fatness</label
                      >
                    </div>
                    <div class="col-5 form-group">
                      <input
                        type="number"
                        class="form-control"
                        id="fatness"
                        min="0"
                        max="1"
                        step="0.01"
                      />
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-head"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-fatness"
                      />
                    </div>
                  </div>
                </div>
                <br />
                <div class="p-3 bg-warning bg-gradient">
                  <div class="row">
                    <div class="col-10"><h4>Hair</h4></div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-group randomize-hair"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-hair"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-10 form-group">
                      <select class="form-control" id="hair-id"> </select>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-hair"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-hair-id"
                      />
                    </div>
                  </div>
                  <div class="row pl-3 pb-3">
                    <div class="col-10">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        value=""
                        checked
                        id="hair-flip"
                      />
                      <label class="form-check-label" for="hair-flip">
                        Flip
                      </label>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-hair"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-hair-flip"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-5">
                      <label for="hair-color">Color</label>
                    </div>
                    <div class="col-5 form-group">
                      <input
                        type="color"
                        class="form-control"
                        id="hair-color"
                      />
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-hair"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-hair-color"
                      />
                    </div>
                  </div>
                </div>
                <br />
                <div class="p-3 bg-info bg-gradient">
                  <div class="row">
                    <div class="col-10"><h4>Long Hair</h4></div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-group randomize-long-hair"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-long-hair"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-10 form-group">
                      <select class="form-control" id="hairBg-id"> </select>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-hair"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-hairBg-id"
                      />
                    </div>
                  </div>
                </div>
                <br />
                <div class="p-3 bg-warning bg-gradient">
                  <div class="row">
                    <div class="col-10"><h4>Facial Hair</h4></div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-group randomize-facial-hair"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-facial-hair"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-10">
                      <div class="form-group">
                        <select class="form-control" id="facialHair-id">
                        </select>
                      </div>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-facial-hair"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-facialHair-id"
                      />
                    </div>
                  </div>
                </div>
                <br />
                <div class="p-3 bg-info bg-gradient">
                  <div class="row">
                    <div class="col-10"><h4>Shave</h4></div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-group randomize-shave"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-shave"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-10">
                      <div class="form-group">
                        <input
                          type="text"
                          class="form-control"
                          id="head-shave"
                        />
                      </div>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-shave"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-head-shave"
                      />
                    </div>
                  </div>
                </div>
              </div>
              <div class="col">
                <div class="p-3 bg-warning bg-gradient">
                  <div class="row">
                    <div class="col-10"><h4>Eyebrows</h4></div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-group randomize-eyebrows"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-eyebrows"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-10 form-group">
                      <select class="form-control" id="eyebrow-id"> </select>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-eyebrows"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-eyebrow-id"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-5">
                      <label for="eyebrow-angle" style="line-height: 2.4em;"
                        >Angle</label
                      >
                    </div>
                    <div class="col-5 form-group">
                      <input
                        type="number"
                        class="form-control"
                        id="eyebrow-angle"
                        min="-15"
                        max="20"
                        step="1"
                      />
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-eyebrows"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-eyebrow-angle"
                      />
                    </div>
                  </div>
                </div>
                <br />
                <div class="p-3 bg-info bg-gradient">
                  <div class="row">
                    <div class="col-10"><h4>Eyes</h4></div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-group randomize-eyes"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-eyes"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-10 form-group">
                      <select class="form-control" id="eye-id"> </select>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-eyes"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-eye-id"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-5">
                      <label for="eye-angle" style="line-height: 2.4em;"
                        >Angle</label
                      >
                    </div>
                    <div class="col-5 form-group">
                      <input
                        type="number"
                        class="form-control"
                        id="eye-angle"
                        min="-15"
                        max="20"
                        step="1"
                      />
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-eyes"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-eye-angle"
                      />
                    </div>
                  </div>
                </div>
                <br />
                <div class="p-3 bg-warning bg-gradient">
                  <div class="row">
                    <div class="col-10"><h4>Nose</h4></div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-group randomize-nose"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-nose"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-10 form-group">
                      <select class="form-control" id="nose-id"> </select>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-nose"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-nose-id"
                      />
                    </div>
                  </div>
                  <div class="row pl-3 pb-3">
                    <div class="col-10">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        value=""
                        checked
                        id="nose-flip"
                      />
                      <label class="form-check-label" for="nose-flip">
                        Flip
                      </label>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-nose"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-nose-flip"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-5">
                      <label for="nose-size">Size</label>
                    </div>
                    <div class="col-5 form-group">
                      <input
                        type="number"
                        class="form-control"
                        id="nose-size"
                        min=".5"
                        max="1.25"
                        step="0.01"
                      />
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-nose"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-nose-size"
                      />
                    </div>
                  </div>
                </div>
                <br />
                <div class="p-3 bg-info bg-gradient">
                  <div class="row">
                    <div class="col-10"><h4>Mouth</h4></div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-group randomize-mouth"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-mouth"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-10 form-group">
                      <select class="form-control" id="mouth-id"> </select>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-mouth"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-mouth-id"
                      />
                    </div>
                  </div>
                  <div class="row pl-3 pb-3">
                    <div class="col-10">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        value=""
                        checked
                        id="mouth-flip"
                      />
                      <label class="form-check-label" for="hair-flip">
                        Flip
                      </label>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-mouth"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-mouth-flip"
                      />
                    </div>
                  </div>
                </div>
              </div>
              <div class="col">
                <div class="p-3 bg-info bg-gradient">
                  <div class="row">
                    <div class="col-10"><h4>Ears</h4></div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-group randomize-ears"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-ears"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-10 form-group">
                      <select class="form-control" id="ear-id"> </select>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-ears"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-ear-id"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-5">
                      <label for="ear-size" style="line-height: 2.4em;"
                        >Size</label
                      >
                    </div>
                    <div class="col-5 form-group">
                      <input
                        type="number"
                        class="form-control"
                        id="ear-size"
                        min="-15"
                        max="20"
                        step="1"
                      />
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-ears"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-ear-size"
                      />
                    </div>
                  </div>
                </div>
                <br />
                <div class="p-3 bg-warning bg-gradient">
                  <div class="row">
                    <div class="col-10"><h4>Accessories</h4></div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-group randomize-accessories"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-accessories"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-10">
                      <div class="form-group">
                        <select class="form-control" id="accessories-id">
                        </select>
                      </div>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-accessories"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-accessories-id"
                      />
                    </div>
                  </div>
                </div>
                <br />
                <div class="p-3 bg-info bg-gradient">
                  <div class="row">
                    <div class="col-10"><h4>Glasses</h4></div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-group randomize-glasses"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-glasses"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-10">
                      <div class="form-group">
                        <select class="form-control" id="glasses-id"> </select>
                      </div>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-glasses"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-glasses-id"
                      />
                    </div>
                  </div>
                </div>
                <br />
                <div class="p-3 bg-warning bg-gradient">
                  <div class="row">
                    <div class="col-10"><h4>Jersey</h4></div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-group randomize-jersey"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-jersey"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-10">
                      <div class="form-group">
                        <select class="form-control" id="jersey-id"> </select>
                      </div>
                    </div>
                    <div class="col-2 text-right">
                      <input
                        class="form-check-input random-attribute randomize-jersey"
                        type="checkbox"
                        value=""
                        checked
                        id="randomize-jersey-id"
                      />
                    </div>
                  </div>
                </div>
                <br />
                <div class="p-3 bg-info bg-gradient">
                  <div class="row">
                    <div class="col-12"><h4>Team Colors</h4></div>
                  </div>
                  <div class="row">
                    <div class="col-6">
                      <label for="body-color">Primary</label>
                    </div>
                    <div class="col-6 form-group">
                      <input
                        type="color"
                        class="form-control"
                        id="teamColors-0"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-6">
                      <label for="body-color">Secondary</label>
                    </div>
                    <div class="col-6 form-group">
                      <input
                        type="color"
                        class="form-control"
                        id="teamColors-1"
                      />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-6">
                      <label for="body-color">Accent</label>
                    </div>
                    <div class="col-6 form-group">
                      <input
                        type="color"
                        class="form-control"
                        id="teamColors-2"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="col" style="flex: 0 0 400px;">
          <div id="face"></div>
          <textarea id="json" class="form-control mt-3"></textarea>
          <button class="btn btn-secondary mt-1" id="copy">
            Copy to clipboard
          </button>
        </div>
      </div>
    </div>
  </body>
  <script src="build/bundle.js"></script>
  <script>
    const faceWrapper = document.getElementById("face");
    const jsonElement = document.getElementById("json");

    document.getElementById("copy").addEventListener("click", () => {
      jsonElement.focus();
      jsonElement.select();

      const successful = document.execCommand("copy");
      const msg = successful ? "successful" : "unsuccessful";
      console.log("Copying text command was " + msg);
    });

    let face;
    if (location.hash.length <= 1) {
      face = faces.generate();
    } else {
      try {
        face = JSON.parse(atob(location.hash.slice(1)));
      } catch (error) {
        console.error(error);
        face = faces.generate();
      }
    }

    const randomizeFace = (oldFace, newFace) => {
      Array.from(document.getElementsByClassName("random-attribute")).forEach(
        (elem) => {
          if (!elem.checked) {
            const parts = elem.id.split("-").slice(1);
            if (parts.length === 1) newFace[parts[0]] = oldFace[parts[0]];
            else if (!isNaN(parseInt(parts[1]))) {
              const idx = parseInt(parts[1]);
              newFace[parts[0]][idx] = oldFace[parts[0]][idx];
            } else if (parts.length === 2)
              newFace[parts[0]][parts[1]] = oldFace[parts[0]][parts[1]];
          }
        }
      );
      return newFace;
    };

    const updateDisplay = () => {
      console.log(face);
      faces.display(faceWrapper, face);
      history.replaceState(
        undefined,
        undefined,
        `#${btoa(JSON.stringify(face))}`
      );
      jsonElement.value = JSON.stringify(face);
    };

    const initializeSelectOptions = () => {
      let selectElement, optionElement;
      for (const feature of Object.keys(faces.svgsIndex)) {
        const options = faces.svgsIndex[feature];
        selectElement = document.getElementById(`${feature}-id`);
        for (const option of options) {
          optionElement = document.createElement("option");
          optionElement.value = option;
          optionElement.text = option;
          selectElement.add(optionElement, null);
        }
      }
      selectElement = document.getElementById("aging-enabled");
      optionElement = document.createElement("option");
      optionElement.value = "true";
      optionElement.text = "Enabled";
      selectElement.add(optionElement, null);
      optionElement = document.createElement("option");
      optionElement.value = "false";
      optionElement.text = "Disabled";
      selectElement.add(optionElement, null);
    };

    const isValue = (obj) =>
      typeof obj === "boolean" ||
      typeof obj === "number" ||
      typeof obj === "string";

    const initializeFormValue = (id, value) => {
      const element = document.getElementById(id);
      if (element.classList.contains("form-check-input")) {
        element.checked = value;
      } else {
        element.value = value;
      }
    };

    const initializeFormValues = () => {
      for (const key of Object.keys(face)) {
        if (isValue(face[key])) {
          initializeFormValue(key, face[key]);
        } else {
          for (const key2 of Object.keys(face[key])) {
            if (isValue(face[key][key2])) {
              initializeFormValue(`${key}-${key2}`, face[key][key2]);
            } else {
              throw new Error(`wtf is in face.${key}.${key2}`);
            }
          }
        }
      }
    };

    const getValue = (oldValue, event) => {
      if (typeof oldValue === "number") {
        return parseFloat(event.target.value);
      }
      if (
        typeof oldValue === "boolean" &&
        typeof event.target.value !== "boolean"
      ) {
        return event.target.value === "true";
      }
      if (typeof oldValue === "boolean") {
        return event.target.checked;
      }
      return event.target.value;
    };
    const listenForChanges = () => {
      const textInputs = document.querySelectorAll("input.form-control");
      const checkboxInputs = document.querySelectorAll(
        "input.form-check-input"
      );
      const selects = document.querySelectorAll("select.form-control");

      for (const input of [...textInputs, ...checkboxInputs, ...selects]) {
        if (input.id.startsWith("randomize")) continue;
        input.addEventListener("change", (event) => {
          const parts = event.target.id.split("-");

          if (parts.length === 1) {
            face[parts[0]] = getValue(face[parts[0]], event);
          } else if (parts.length === 2) {
            face[parts[0]][parts[1]] = getValue(
              face[parts[0]][parts[1]],
              event
            );
          } else {
            throw new Error(`Invalid ID ${event.target.id}`);
          }

          updateDisplay();
        });
      }

      document.getElementById("randomize").addEventListener("click", () => {
        face = randomizeFace(face, faces.generate());
        initializeFormValues();
        updateDisplay();
      });
      Array.from(document.getElementsByClassName("random-group")).forEach(
        (elem) => {
          elem.addEventListener("click", () => {
            if (elem.checked) {
              Array.from(
                document.getElementsByClassName(elem.id.replace("-group", ""))
              ).forEach((elem2) => (elem2.checked = true));
            } else {
              Array.from(
                document.getElementsByClassName(elem.id.replace("-group", ""))
              ).forEach((elem2) => (elem2.checked = false));
            }
          });
        }
      );
      Array.from(document.getElementsByClassName("random-attribute")).forEach(
        (elem) => {
          elem.addEventListener("click", () => {
            if (!elem.checked) {
              Array.from(elem.className.split(" ")).forEach((className) => {
                if (className.startsWith("randomize-")) {
                  document.getElementById(className + "-group").checked = false;
                }
              });
            }
          });
        }
      );
    };

    updateDisplay();
    initializeSelectOptions();
    initializeFormValues();
    listenForChanges();

    // Reload when something changes
    const socket = new WebSocket("ws://localhost:3001/");
    socket.addEventListener("message", (event) => {
      if (event.data === "reload") {
        location.reload();
      }
    });
  </script>

  <script type="text/javascript">
    if (location.host.indexOf("dumbmatter.com") >= 0) {
      (function (i, s, o, g, r, a, m) {
        i["GoogleAnalyticsObject"] = r;
        (i[r] =
          i[r] ||
          function () {
            (i[r].q = i[r].q || []).push(arguments);
          }),
          (i[r].l = 1 * new Date());
        (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
      })(
        window,
        document,
        "script",
        "https://www.google-analytics.com/analytics.js",
        "ga"
      );
      ga("create", "UA-23918822-5", "auto");
      ga("send", "pageview");
    }
  </script>
</html>
